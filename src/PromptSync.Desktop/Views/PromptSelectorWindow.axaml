<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:PromptSync.Desktop.ViewModels"
        xmlns:models="using:PromptSync.Core.Models"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="600"
        x:Class="PromptSync.Desktop.Views.PromptSelectorWindow"
        x:DataType="vm:PromptSelectorViewModel"
        Title="PromptSync - Select Prompt"
        Width="800" Height="600"
        WindowStartupLocation="CenterScreen"
        Background="#F5F5F5"
        CanResize="True">

  <Window.Styles>
    <Style Selector="TextBlock">
      <Setter Property="FontFamily" Value="Segoe UI,SF Pro,system-ui"/>
    </Style>
  </Window.Styles>

  <Border Background="White"
          BorderThickness="0"
          Padding="20">
    
    <Grid RowDefinitions="Auto,Auto,*,Auto">
      
      <!-- Header -->
      <TextBlock Grid.Row="0"
                 Text="PromptSync"
                 FontSize="24"
                 FontWeight="Bold"
                 Margin="0,0,0,20"/>

      <!-- Search Box -->
      <Grid Grid.Row="1" ColumnDefinitions="*,Auto" Margin="0,0,0,10">
        <TextBox Grid.Column="0"
                 Text="{Binding SearchQuery}"
                 Watermark="Search prompts (title, tags, content)..."
                 FontSize="16"
                 Padding="12,8"/>
        
        <StackPanel Grid.Column="1" 
                    Orientation="Horizontal" 
                    Spacing="8" 
                    Margin="8,0,0,0">
          <Button Content="?"
                  ToolTip.Tip="Refresh prompts"
                  Command="{Binding LoadPromptsCommand}"
                  FontSize="18"
                  Width="40"
                  Height="40"/>
          <Button Content="?"
                  ToolTip.Tip="Settings"
                  FontSize="18"
                  Width="40"
                  Height="40"/>
        </StackPanel>
      </Grid>

      <!-- Prompts List -->
      <Border Grid.Row="2"
              Background="#FAFAFA"
              Padding="8"
              BorderThickness="1"
              BorderBrush="#E0E0E0">
        
        <ListBox ItemsSource="{Binding FilteredPrompts}"
                 SelectedItem="{Binding SelectedPrompt}"
                 Background="Transparent"
                 BorderThickness="0">
          
          <ListBox.ItemTemplate>
            <DataTemplate DataType="models:Prompt">
              <Border Padding="12"
                      Margin="4"
                      Background="White"
                      BorderThickness="1"
                      BorderBrush="#E0E0E0">
                <StackPanel Spacing="8">
                  <TextBlock Text="{Binding Title}"
                             FontSize="16"
                             FontWeight="SemiBold"
                             TextWrapping="Wrap"/>
                  
                  <ItemsControl ItemsSource="{Binding Tags}">
                    <ItemsControl.ItemsPanel>
                      <ItemsPanelTemplate>
                        <StackPanel Orientation="Horizontal" Spacing="6"/>
                      </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                    <ItemsControl.ItemTemplate>
                      <DataTemplate>
                        <Border Background="#E3F2FD"
                                Padding="6,3">
                          <TextBlock Text="{Binding}"
                                     FontSize="11"
                                     Foreground="#1976D2"/>
                        </Border>
                      </DataTemplate>
                    </ItemsControl.ItemTemplate>
                  </ItemsControl>
                  
                  <TextBlock Text="{Binding Content}"
                             FontSize="13"
                             Opacity="0.8"
                             TextWrapping="Wrap"
                             MaxHeight="60"
                             TextTrimming="CharacterEllipsis"/>
                </StackPanel>
              </Border>
            </DataTemplate>
          </ListBox.ItemTemplate>
          
        </ListBox>
      </Border>

      <!-- Footer / Status -->
      <Grid Grid.Row="3" 
            ColumnDefinitions="*,Auto,Auto" 
            Margin="0,12,0,0">
        
        <TextBlock Grid.Column="0"
                   Text="{Binding StatusMessage}"
                   VerticalAlignment="Center"
                   FontSize="12"
                   Opacity="0.7"/>
        
        <Button Grid.Column="1"
                Content="Select"
                Command="{Binding SelectPromptCommand}"
                CommandParameter="{Binding SelectedPrompt}"
                IsEnabled="{Binding HasSelection}"
                FontSize="14"
                Padding="20,8"
                Margin="0,0,8,0"/>
        
        <Button Grid.Column="2"
                Content="Cancel"
                Command="{Binding CancelCommand}"
                FontSize="14"
                Padding="20,8"/>
      </Grid>
      
    </Grid>
  </Border>
</Window>
